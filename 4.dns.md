

#  DNS Assignment

---

##  Introduction: The `dig` utility

To carry out this practical assignment we will use the **`dig`** utility. Below we resume the main options of this command but we recommend you consult the complete manual page, which can be obtained via the command:

```bash
man dig
```

If you prefer you may also use the **`host`** or **`nslookup`** utilities which are similar to `dig`.

### General syntax

```bash
dig [@server] [-p port#] [name] [type] [queryopt...]
```

### Main options

* **`@server`**
  Specifies the name or IP address of the DNS server to query.
  If omitted, servers from `/etc/resolv.conf` are used.

* **`-p port`**
  Indicates a non-default server port (default is 53).

* **`name`**
  Domain name of the resource record to query.

* **`type`**
  Record type (A, MX, NS, SOA, ANY, etc.).
  Default is **A**.

* **`queryopt`**

  * `+tcp` → force TCP
  * `+notcp` → force UDP
  * `+ignore` → do not retry TCP if UDP is truncated
  * `+norecurse` → iterative query (default is recursive)

---

##  Assignment Structure

* **Part 1** → Queries using a DNS client (`dig`)
* **Part 2** → Setting up a DNS server using **`named`**

---

##  DNS Resource Record (RR) format

```text
<domain name> <TTL> IN <record type> <value>
```

---

#  Part 1: Queries with a DNS client

---

## 1. Determine the IP address of `www.mec.es`

```bash
dig www.mec.es
```

**Answer:**

```text
;; ANSWER SECTION:
www.mec.es.  83061  IN  A  212.128.114.29
```

---

## 1. Check which machine has IP `193.110.128.199`

```bash
dig -x 193.110.128.199
```

**Answer:**

```text
;; ANSWER SECTION:
199.128.110.193.in-addr.arpa. 83238 IN PTR www.elmundo.es.
```

---

## 3. DNS servers of `abc.es` and identify primary/secondary

### NS records

```bash
dig NS abc.es
```

```text
abc.es. 10930 IN NS ns-cloud-e3.googledomains.com.
abc.es. 10930 IN NS ns-cloud-e1.googledomains.com.
abc.es. 10930 IN NS ns-cloud-e2.googledomains.com.
abc.es. 10930 IN NS ns-cloud-e4.googledomains.com.
```

### SOA record

```bash
dig SOA abc.es
```

```text
abc.es. 10589 IN SOA ns-cloud-e1.googledomains.com. cloud-dns-hostmaster.google.com.
```

```text
dig googledomains.com SOA => return SOA RR it is a SOA
```

---

## 4. SOA via local DNS vs authoritative server

### Local DNS

```bash
dig abc.es SOA
```

* Same answer as before
* ❌ **No `aa` flag** → not authoritative

### Authoritative DNS

```bash
dig @ns-cloud-e1.googledomains.com abc.es SOA
```

* ✅ **Answer contains `aa` flag** → authoritative

---

## 5. Email address of DNS administrator

```bash
dig SOA abc.es
```

```text
;; ANSWER SECTION:
abc.es. 10589 IN SOA ns-cloud-e1.googledomains.com. cloud-dns-hostmaster.google.com.
```

---

## 6️. Mail server of the administrator

```bash
dig google.com MX
```

```text
google.com. 300 IN MX 10 smtp.google.com.
```

```bash
dig smtp.google.com
```

---

## 7️. TTL behavior for `www.vanguardia.es`

```bash
dig lavanguardia.es NS
```

```bash
dig @dns01.grupogodo.com www.vanguardia.es
```

* TTL shown is the **maximum TTL**
* No cache involved when querying authoritative server

---

## 8️. Query a root server (no recursion)

```bash
dig @192.58.128.30 www.vanguardia.es
```

* ❌ **No `ra` flag**
* Root servers do **not** support recursion

---

## 9️. Load balancing in `www.elpais.es`

```bash
dig www.elpais.es
```

* Two IP addresses returned
* Order may change between queries

---

## 10. Iterative resolution of `www.pcreview.co.uk`

> Hint: if your DNS server has this record cached, query a root server directly:

```bash
dig +norecurse www.pcreview.co.uk @A.ROOT-SERVERS.NET
```

Continue iteratively through:

* Root → `.uk` → `.co.uk` → authoritative server

Same process attempted for:

```
www.bbc.co.uk
```

---

## 11️. Using `+trace`

```bash
dig +trace www.pcreview.co.uk
```

Shows the **full resolution path** step by step.

---

## 12️. Mail servers for `gmail.com`

```bash
dig MX gmail.com
```

```text
gmail.com. 3600 IN MX 5 gmail-smtp-in.l.google.com.
gmail.com. 3600 IN MX 10 alt1.gmail-smtp-in.l.google.com.
gmail.com. 3600 IN MX 20 alt2.gmail-smtp-in.l.google.com.
gmail.com. 3600 IN MX 30 alt3.gmail-smtp-in.l.google.com.
gmail.com. 3600 IN MX 40 alt4.gmail-smtp-in.l.google.com.
```

---

## 13️. Obtain all records for `lab.it.uc3m.es`

```bash
dig NS lab.it.uc3m.es
```

```bash
dig @tamtam.it.uc3m.es lab.it.uc3m.es ANY
```

---

## 14️. Identify zones

```bash
dig domain SOA
```

* If SOA exists → **zone**
* If not → **not a zone**

Domains:

* `google.jobs`
* `primevideo.com`
* `inf.uc3m.es`
* `it.uc3m.es`

---

## 15️. DNS details for `it.uc3m.es` and `csic.es`

```bash
dig domain NS
dig domain MX
dig domain SOA
```

SOA fields:

```
<zone> SOA <MNAME> <RNAME> <serial> <refresh> <retry> <expire> <minimum>
```

---

#  Part 2: Creating a domain in a `named` DNS server

---

##  Running `named`

```bash
/usr/dist/sbin/named -c ./named.conf -f
```

> ⚠️ Warning: library warnings may appear — ignore if server runs correctly
> Alternative binary: `/usr/sbin/named`

---

## Example `named.conf`

```conf
options {
 port 10053;
 directory "$HOME/rroo/named/";
 pid-file "$HOME/rroo/named/named.pid";
};
```

### Zone definitions

```conf
zone "0.0.127.in-addr.arpa" IN {
 type master;
 file "$HOME/rroo/named/127.0.0";
};

zone "midominio.privado" IN {
 type master;
 file "$HOME/rroo/named/midominio.privado";
};
```

---

## Forward zone file (`midominio.privado`)

```dns
$TTL 86400
@ IN SOA ns.midominio.privado. mail.midominio.privado. (
 200403031
 28800
 7200
 604800
 86400 )
 NS ns.midominio.privado.
 MX 10 mail.midominio.privado.
ns   A 192.168.123.1
mail A 192.168.123.2
www  CNAME ns
```

---

## Reverse zone creation (summary steps)

### 1️ Network

```
192.168.122.0/24
```

Reverse zone:

```
122.168.192.in-addr.arpa
```

---

### 2️ Add to `named.conf`

```conf
zone "122.168.192.in-addr.arpa" IN {
 type master;
 file "/full/path/to/named/192.168.122";
};
```

---

### 3️ Reverse zone file

```dns
$TTL 86400
@ IN SOA ns.midominio.privado. mail.midominio.privado. (
 2025121601
 28800
 7200
 604800
 86400 )
@ IN NS ns.midominio.privado.
1 IN PTR ns.midominio.privado.
2 IN PTR mail.midominio.privado.
```

---

### 4️ Permissions

```bash
chmod 644 /full/path/to/named/192.168.122
```

---

### 5️ Restart `named`

```bash
/usr/dist/sbin/named -c ./named.conf -f
```

---

### 6️ Test reverse resolution

```bash
dig @localhost -p 10053 -x 192.168.122.1
dig @localhost -p 10053 -x 192.168.122.2
```

Expected:

```text
1.122.168.192.in-addr.arpa. PTR ns.midominio.privado.
```

